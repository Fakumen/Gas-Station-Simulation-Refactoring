## Описание проекта

Данный репозиторий является демонстрацией процесса рефакторинга проекта GasStationsSimulationModel – [https://github.com/Fakumen/GasStationsSimulationModel](https://github.com/Fakumen/GasStationsSimulationModel).  

Ветка `main` – актуальная версия (мёрдж с `Refactoring-Only`).

Ветка `Initial-Version` – изначальная версия с постоянным Random-seed\`ом `0` для сверки с изначальным поведением. Аналогична [старому репозиторию](https://github.com/Fakumen/GasStationsSimulationModel "https://github.com/Fakumen/GasStationsSimulationModel"), если установить в нём тот же seed.

Ветка `Refactoring-Only` – ветка с описаниями всех коммитов изменений, в которой вёлся рефакторинг.

## Задание

Имеется сеть АЗС: 14 стационарных и 16 мини ААЗС. А также четыре вида топлива: 92, 95, 98, Дт. У АЗС имеются все четыре вида: 92 (емкость 30000л), 95 (емкость 16000л), 98 (емкость 16000л), Дт (емкость 30000л); а у ААЗС только 92 (емкость 16000л) и 95 (емкость 15000л). На каждой станции ведётся учёт прихода и расхода топлива, а также суммарной выручки.

Цены на виды топлива представлены в следующей таблице:
| Тип топлива | Цена, руб |
|-----|-----|
| 92 | 45,6 |
| 95 | 48,2 |
| 98 | 50,3 |
| Дт | 51,5 |

На заправку приезжают клиенты с потребностью определённого вида топлива в определённом объёме:  

* Клиенты на легковых авто приезжают на каждую АЗС/ААЗС с интервалом Random(5), объёмом потребляемого топлива Random(40) + 10 случайного вида: 92, 95, 98, Дт.  
* Клиенты на грузовых авто приезжают на каждую АЗС/ААЗС с интервалом Random(12), объёмом потребляемого топлива Random(270) + 30 случайного вида: 92, Дт.

Также имеется парк наёмных 2-3-секционных бензовозов (объёмом секции 6000л). Поставка может осуществлятся бензовозом на несколько станций за рейс. 

Снабжение заправок осуществляется по двум стратегиям:

* По критическому уровню топлива на заправке. При этой стратегии по достижению критического уровня топлива бензовозы вызываются с нефтебазы.
* По времени. При этой стратегии пополнение хранилищ осуществляется по истечении определённого промежутка времени.

*В каждой секции перевозится только один вид топлива. Секция полностью сливается на АЗС/ААЗС. Мини ААЗС 3х и более секционными бензовозами не обслуживаются.*

**Примечания**

* Единицы измерения: объём - целочисленные литры, время - целочисленные минуты.
* Один шаг (такт) симуляции равен одной минуте
* Интервал заправки станции принят за 24 часа (1440 минут)
* Критический уровень топлива принят за 1000л
* Размер цистерны бензовоза принят за 6000л

***

**Смоделировать в течение 10 дней:**

* Процесс потребления топлива на АЗС/ААЗС
* Процесс снабжения топливом

**Оценить:**

* Долю обслуженных клиентов по АЗС/ААЗС
* Выручку на АЗС/ААЗС
* Количество рейсов 2/3-секционных бензовозов по дням
* Определить требуемый парк бензовозов (сколько и какого типа)

***

## Рефакторинг

### Изначальные проблемы

Изначальная версия программы имела множество функциональных, стилистических и прочих недостатков:

1. Некорректная работа программы, неочевидные ошибки.
2. Трудноподдерживаемый, труднорасширяемый и трудночитаемый код с ужасной инкапсуляцией.
3. Наименования, не соответствующие доменной области.

Из некорректного поведения можно выделить следующее.  
* Счёт общего кол-ва заказов учитывал заказы поставленные в очередь, но которые, при этом, ещё могли не появиться.  
* Такт симуляции для ожидания заказа проходил вместе с тактом для станции, на которую он должен поступить.

Стилистические, архитектурные и прочие проблемы кода:

1. Логика симуляции, составления статистики, вывод отчёта и пользовательский ввод тесно взаимосвязаны между собой. Нет разделения ответственностей.
2. Взаимосвязь между классами на статике.
3. Неочевидный алгоритм появления новых заказов.
4. Публичные поля.
5. Злоупотребление Nullable.
6. Очерёдность, зависящая от перечисления HashSet.
7. Неговорящий и не соответствующий домену нейминг.
8. Out-параметры вместо возвращаемого значения в методах.
9. Неизвестный закомментированный код.
10. Неиспользуемые неймспейсы.


### Цели работы

Проект по рефакторингу программы имеет следующие цели:

1. Сохранить изначальное поведение программы.
2. Сделать код более читаемым, расширяемым и понятным.
3. Принять меры, чтобы некорректное изначальное поведение програмы было легко заменить на правильное.

### План рефакторинга

План выполнения работ по рефакторингу:

1. Избавление от класса Fuel. Переход на enum.
2. Рефакторинг статических публичных полей.
3. Перенос типа клиента на Enum.
4. Синтаксис обработки заказа станцией.
5. Разделение ответственностей. Создание специализированных сущностей и инкапсуляция классов:
	* Статистика.
    * Пользовательский ввод-вывод.
    * Симуляция.
    * Генератор заказов.
    * Управление бензовозами.
6. Рефакторинг класса бензовоза.
7. Организация проекта:
	* Структуризация файлов по каталогам.
	* Переименование в соответствии с доменной областью.
	* Удаление лишних директив using.
8. Подведение итогов. Пути дальнейшего улучшения.

## Словарь доменной области

**Fuel Station** (ранее GasStation) – автомобильная заправочная станция (АЗС). Общее название для всех заправочных станций.  
Английские синонимы: petrol station, filling station, gas station, petrol pump.  
Русские синонимы: автозаправочная станция, “бензоколонка”, “бензозаправка”, “заправка”.  
**Stationary Fuel Station** – стационарная АЗС.  
Русские синонимы: обычная АЗС, подземная АЗС.  
**Mini Fuel Station** – мини АЗС.  
Русские синонимы: контейнерная автозаправочная станция (КАЗС), АЗС контейнерного типа, модульная АЗС, мобильная АЗС, надземная АЗС.  
**Self-service Fuel Station** – автоматизированная АЗС (ААЗС).  
Русские синонимы: АЗС самообслуживания, безоператорная АЗС.  
**Fuel** – топливо. Общее название для всех видов топлива.  
**Fuel Tanker** (ранее GasolineTanker) – бензовоз.  
Английские синонимы: tanker, tank truck, tanker truck, fuel truck, petrol truck, gasoline truck, gas truck.  


## Итоги рефакторинга

По итогам проведённого рефакторинга все цели были достигнуты. Большинство стилистических и архитектурных проблем устранено.  

Способы дальнейшего улучшения:

1. Переход с некорректного поведения на корректное.
2. Создание симуляции по единому пресету со всеми значениями параметров.
3. Покрытие unit-тестами.
4. Улучшение логики связи типов клиентов – с потребляемым топливом; типов станций – с предоставляемым, а также с допустимыми на них бензовозами.
5. Выделенный обработчик команд (аналогичных “-debug stations”).
6. Оптимизация построения статистики и её хэширование.

Решение остановиться было принято из следующих соображений:  

* Дальнейшие улучшения не являются существенными для демонстрации процесса рефакторинга. 
* Дальнейшие улучшения требуют более чёткого понимания дальнейшего развития проекта. 
* Дальнейшие улучшения требуют временных затрат.

## Спасибо за ваше время
